<div class="table-card">
  <div class="table-header">
    <h2 class="table-title">Listado de Vehículos</h2>
    <span class="table-count">Mostrando {{ vehicles.length }} de {{ totalFiltered }}</span>
  </div>

  @if (loading) {
    <div class="table-loading">
      <app-loading-card message="Cargando vehículos..."></app-loading-card>
    </div>
  } @else if (error) {
    <div class="table-error">
      <app-empty-state
        icon="exclamation-triangle"
        title="No se pudieron cargar los vehículos"
        [description]="error"
      ></app-empty-state>
    </div>
  } @else if (vehicles.length === 0) {
    <div class="table-empty">
      <app-empty-state
        icon="truck"
        title="No se encontraron vehículos"
      ></app-empty-state>
    </div>
  } @else {
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Vehículo</th>
            <th>Tipo / Modelo</th>
            <th>Aliado</th>
            <th>Capacidad</th>
            <th>Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (vehicle of vehicles; track vehicle.id) {
            <tr class="table-row">
              <td>
                <div class="vehicle-info">
                  <div class="vehicle-image" [style.background-image]="vehicle.image ? 'url(' + vehicle.image + ')' : 'none'">
                    @if (!vehicle.image) {
                      <app-hero-icon name="truck" [size]="24" class="vehicle-placeholder-icon"></app-hero-icon>
                    }
                  </div>
                  <div class="vehicle-details">
                    <p class="vehicle-plate">{{ vehicle.license_plate }}</p>
                    <p class="vehicle-id">ID: {{ vehicle.id }}</p>
                  </div>
                </div>
              </td>
              <td>
                <p class="vehicle-type">{{ getVehicleTypeLabel(vehicle.vehicle_type) }}</p>
                <p class="vehicle-model">{{ vehicle.model || '-' }}</p>
              </td>
              <td>
                <p class="vehicle-provider">{{ vehicle.provider_name || '-' }}</p>
              </td>
              <td>
                <p class="vehicle-capacity">{{ vehicle.capacity || '-' }}</p>
              </td>
              <td>
                <span class="status-badge" [class]="getStatusClass(vehicle.status)">
                  {{ getStatusLabel(vehicle.status) }}
                </span>
              </td>
              <td class="text-right">
                <div class="action-buttons">
                  @if (vehicle.id && allyId) {
                    <a
                      class="action-btn"
                      title="Ver Detalle"
                      [routerLink]="['/allies', allyId, 'vehicles', vehicle.id]"
                      [queryParams]="{ name: allyName ?? undefined }"
                    >
                      <app-hero-icon name="clock" [size]="18"></app-hero-icon>
                    </a>
                  } @else {
                    <button class="action-btn" title="Ver Detalle" disabled>
                      <app-hero-icon name="clock" [size]="18"></app-hero-icon>
                    </button>
                  }
                  <button class="action-btn" title="Editar">
                    <app-hero-icon name="pencil" [size]="18"></app-hero-icon>
                  </button>
                  <button class="action-btn action-btn-danger" title="Reportar Incidente">
                    <app-hero-icon name="exclamation-circle" [size]="18"></app-hero-icon>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
