<div class="dashboard-container">
  <!-- Header del Dashboard -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1 class="dashboard-title">Resumen de Operaciones</h1>
      <div class="search-container">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          placeholder="Buscar por ID de rastreo, cliente..."
          [(ngModel)]="searchQuery"
        />
      </div>
    </div>
    <div class="header-right">
      <div class="user-dropdown">
        <span class="user-label">ADMIN</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
      </div>
      <button class="icon-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </button>
      <div class="user-avatar">
        <span>A</span>
      </div>
    </div>
  </div>

  <!-- Cards de Métricas -->
  <div class="metrics-grid">
    <div class="metric-card metric-card-orders" style="animation-delay: 0.1s">
      <div class="metric-header">
        <div class="metric-icon orders">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
            <line x1="3" y1="9" x2="21" y2="9"></line>
          </svg>
        </div>
        <span class="metric-badge positive">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
          </svg>
          +{{ totalShipmentsChange().value }}%
        </span>
      </div>
      <div class="metric-content">
        <h3 class="metric-value">{{ totalShipments() | number }}</h3>
        <p class="metric-label">Total Envíos</p>
        <p class="metric-description">Comparado con semana anterior</p>
      </div>
      <div class="metric-hover-effect"></div>
    </div>

    <div class="metric-card metric-card-success" style="animation-delay: 0.2s">
      <div class="metric-header">
        <div class="metric-icon success">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <span class="metric-badge positive">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
          </svg>
          +{{ deliveredSuccessChange().value }}%
        </span>
      </div>
      <div class="metric-content">
        <h3 class="metric-value">{{ deliveredSuccess() }}%</h3>
        <p class="metric-label">Entregados (Éxito)</p>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="deliveredSuccess()"></div>
        </div>
      </div>
      <div class="metric-hover-effect"></div>
    </div>

    <div class="metric-card metric-card-alert" style="animation-delay: 0.3s">
      <div class="metric-header">
        <div class="metric-icon alert">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
            <line x1="12" y1="9" x2="12" y2="13"></line>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </div>
        <span class="metric-badge alert-badge">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"></polygon>
          </svg>
          Alert
        </span>
      </div>
      <div class="metric-content">
        <h3 class="metric-value">{{ awaitingAssignment() }}</h3>
        <p class="metric-label">En Espera de Asignación</p>
        <p class="metric-description">Requieren vehículo</p>
      </div>
      <div class="metric-hover-effect"></div>
    </div>

    <div class="metric-card metric-card-incidents" style="animation-delay: 0.4s">
      <div class="metric-header">
        <div class="metric-icon incidents">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        </div>
        <span class="metric-badge negative">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
            <polyline points="17 18 23 18 23 12"></polyline>
          </svg>
          -{{ activeIncidentsChange().value }}%
        </span>
      </div>
      <div class="metric-content">
        <h3 class="metric-value">{{ activeIncidents() }}</h3>
        <p class="metric-label">Incidentes Activos</p>
        <p class="metric-description">Atención inmediata requerida</p>
      </div>
      <div class="metric-hover-effect"></div>
    </div>
  </div>

  <!-- Gestión de Envíos -->
  <div class="shipments-section">
    <div class="shipments-header">
      <div>
        <h2 class="shipments-title">Gestión de Envíos</h2>
        <p class="shipments-subtitle">Visualiza y gestiona el estado de todos los pedidos.</p>
      </div>
      <div class="shipments-actions">
        <button class="btn btn-secondary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
          Filtros
        </button>
        <a routerLink="/orders/new" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          + Nuevo Envío
        </a>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <button 
        class="tab" 
        [class.active]="activeTab() === 'all'"
        (click)="setActiveTab('all')"
      >
        Todos
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab() === 'in-route'"
        (click)="setActiveTab('in-route')"
      >
        En Ruta
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab() === 'pending'"
        (click)="setActiveTab('pending')"
      >
        Pendientes
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab() === 'delivered'"
        (click)="setActiveTab('delivered')"
      >
        Entregados
      </button>
      <button 
        class="tab" 
        [class.active]="activeTab() === 'incidents'"
        (click)="setActiveTab('incidents')"
      >
        Incidentes
        @if (getIncidentsCount() > 0) {
          <span class="tab-badge">{{ getIncidentsCount() }}</span>
        }
      </button>
    </div>

    <!-- Tabla de Envíos -->
    <div class="table-card">
      <div class="table-wrapper">
        <table class="shipments-table">
          <thead>
            <tr>
              <th>ID ENVÍO</th>
              <th>CLIENTE</th>
              <th>DESTINO / ETA</th>
              <th>VEHÍCULO</th>
              <th>ESTADO</th>
              <th class="actions-header">ACCIONES</th>
            </tr>
          </thead>
          <tbody>
            @if (loading()) {
              <tr>
                <td colspan="6" class="loading-cell">
                  <div class="loading-spinner"></div>
                  <p>Cargando envíos...</p>
                </td>
              </tr>
            } @else {
              @for (shipment of getFilteredShipments(); track shipment.id) {
                <tr>
                  <td class="id-cell">#{{ shipment.id }}</td>
                  <td class="client-cell">
                    <div class="client-info">
                      <div class="client-avatar" [class]="'avatar-' + shipment.client.avatar.toLowerCase()">
                        {{ shipment.client.avatar }}
                      </div>
                      <div>
                        <div class="client-name">{{ shipment.client.name }}</div>
                        @if (shipment.client.type) {
                          <div class="client-type">{{ shipment.client.type }}</div>
                        }
                      </div>
                    </div>
                  </td>
                  <td class="destination-cell">
                    <div class="destination-address">{{ shipment.destination }}</div>
                    <div class="destination-eta" [class.delayed]="shipment.eta.includes('Retrasado')" [class.delivered]="shipment.eta.includes('Entregado')">
                      {{ shipment.eta }}
                    </div>
                  </td>
                  <td class="vehicle-cell">
                    @if (shipment.vehicle) {
                      <div>
                        <div class="vehicle-name">{{ shipment.vehicle.name }}</div>
                        @if (shipment.vehicle.plate) {
                          <div class="vehicle-plate">Placa: {{ shipment.vehicle.plate }}</div>
                        }
                      </div>
                    } @else {
                      <a href="#" class="assign-link">Asignar</a>
                    }
                  </td>
                  <td>
                    <span [class]="'status-badge status-' + shipment.status">
                      @if (shipment.status === 'in-route') {
                        <span class="status-dot"></span>
                      } @else if (shipment.status === 'incident') {
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        </svg>
                      } @else if (shipment.status === 'delivered') {
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                      } @else {
                        <span class="status-dot"></span>
                      }
                      {{ shipment.statusText }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button class="action-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="12" cy="5" r="1"></circle>
                        <circle cx="12" cy="19" r="1"></circle>
                      </svg>
                    </button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <div class="pagination">
        <span class="pagination-info">Mostrando 1-5 de {{ totalShipmentsCount() }} envíos</span>
        <div class="pagination-buttons">
          <button class="pagination-btn" [disabled]="currentPage() === 1">Anterior</button>
          <button class="pagination-btn" [disabled]="currentPage() * 5 >= totalShipmentsCount()">Siguiente</button>
        </div>
      </div>
    </div>
  </div>
</div>

